@namespace FluentSignals.WebAssembly.Components.Pages.Demos.HttpResourceDemo.Components
@using FluentSignals.Blazor.Components
@using FluentSignals.Blazor.Extensions
@using FluentSignals.WebAssembly.Components
@using FluentSignals.Options.HttpResource
@inherits SignalComponentBase


<div class="demo-content">
            <div class="error-demo-controls">
                <select @bind="selectedErrorCode" class="error-select">
                    <option value="200">200 - Success</option>
                    <option value="400">400 - Bad Request</option>
                    <option value="401">401 - Unauthorized</option>
                    <option value="404">404 - Not Found</option>
                    <option value="500">500 - Server Error</option>
                    <option value="503">503 - Service Unavailable</option>
                </select>
                <button class="btn btn-primary" @onclick="TriggerError">
                    Test Error
                </button>
            </div>
            
            <HttpResourceView T="object" 
                              Url="@($"/api/weather/error/{selectedErrorCode}")"
                              LoadOnInit="false"
                              @ref="errorDemoView">
                <BadRequest>
                    <div class="error-card bad-request">
                        <span class="error-code">400</span>
                        <h3>Bad Request</h3>
                        <p>The request was invalid. Please check your input.</p>
                    </div>
                </BadRequest>
                
                <Unauthorized>
                    <div class="error-card unauthorized">
                        <span class="error-code">401</span>
                        <h3>Unauthorized</h3>
                        <p>Please login to access this resource.</p>
                        <button class="btn btn-primary">Login</button>
                    </div>
                </Unauthorized>
                
                <NotFound>
                    <div class="error-card not-found">
                        <span class="error-code">404</span>
                        <h3>Not Found</h3>
                        <p>The requested resource could not be found.</p>
                    </div>
                </NotFound>
                
                <InternalServerError>
                    <div class="error-card server-error">
                        <span class="error-code">500</span>
                        <h3>Server Error</h3>
                        <p>Something went wrong on our end. Please try again later.</p>
                    </div>
                </InternalServerError>
                
                <ServiceUnavailable>
                    <div class="error-card service-unavailable">
                        <span class="error-code">503</span>
                        <h3>Service Unavailable</h3>
                        <p>The service is temporarily unavailable. Please try again later.</p>
                    </div>
                </ServiceUnavailable>
                
                <Success Context="data">
                    <div class="success-card">
                        <span class="success-icon">âœ…</span>
                        <h3>Success!</h3>
                        <p>Request completed successfully.</p>
                    </div>
                </Success>
            </HttpResourceView>

    <CodeBlock Code="@HttpErrorHandlingDemo.CodeExample" />
        </div>

@code {
    private HttpResourceView<object>? errorDemoView;
    private int selectedErrorCode = 404;

    private async Task TriggerError()
    {
        if (errorDemoView != null)
        {
            await errorDemoView.RefreshAsync();
        }
    }

    public static readonly string CodeExample = @"<HttpResourceView T=""ApiResponse"" 
                  Url=""@apiUrl""
                  LoadOnInit=""false"">
    <BadRequest>
        <div class=""error-400"">
            <h3>Bad Request</h3>
            <p>Please check your input</p>
        </div>
    </BadRequest>
    
    <Unauthorized>
        <div class=""error-401"">
            <h3>Unauthorized</h3>
            <button @onclick=""Login"">Login</button>
        </div>
    </Unauthorized>
    
    <Forbidden>
        <div class=""error-403"">
            <h3>Access Denied</h3>
            <p>You don't have permission</p>
        </div>
    </Forbidden>
    
    <NotFound>
        <div class=""error-404"">
            <h3>Not Found</h3>
            <p>The resource doesn't exist</p>
        </div>
    </NotFound>
    
    <InternalServerError>
        <div class=""error-500"">
            <h3>Server Error</h3>
            <p>Something went wrong</p>
        </div>
    </InternalServerError>
    
    <ServiceUnavailable>
        <div class=""error-503"">
            <h3>Service Unavailable</h3>
            <p>Please try again later</p>
        </div>
    </ServiceUnavailable>
</HttpResourceView>";
}

<style>
    .error-demo-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .error-select {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
    }

    .error-card, .success-card {
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .error-card {
        background: #fef2f2;
        border: 2px solid #fecaca;
    }

    .error-card.bad-request {
        background: #fef3c7;
        border-color: #fde68a;
    }

    .error-card.unauthorized {
        background: #e0e7ff;
        border-color: #c7d2fe;
    }

    .error-card.not-found {
        background: #f3f4f6;
        border-color: #d1d5db;
    }

    .error-card.server-error {
        background: #fee2e2;
        border-color: #fecaca;
    }

    .error-card.service-unavailable {
        background: #fed7aa;
        border-color: #fdba74;
    }

    .error-code {
        font-size: 3rem;
        font-weight: 700;
        display: block;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .success-card {
        background: #dcfce7;
        border: 2px solid #bbf7d0;
    }

    .success-icon {
        font-size: 3rem;
        display: block;
        margin-bottom: 1rem;
    }
</style>